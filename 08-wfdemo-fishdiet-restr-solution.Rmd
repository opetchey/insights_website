```{r message=FALSE, echo=TRUE, warning=FALSE}
# Load the libraries we use
library(dplyr)
library(ggplot2)
library(readr)
library(stringr)
library(lubridate)
library(skimr)
library(tidyr)
library(ggbeeswarm)
library(taxize)
library(broom)
library(forcats)
```

# Solutions: What are the effects of dietary restriction? {#WFD-diet-restrict-solutions}

<img src="images/WF4_icon.jpg" width="60"/>

## About these solutions

At the time of publication (early 2021) there are likely some improvements that could be made to these solutions, in terms of the description of what we do in it, why we do it, and how we do it. If anything seems odd, unclear, or sub-optimal, please don't hesitate to get in touch, and we will quickly make improvements.

**Q1 Types of response variable for each individual characteristic**

* Mortality---binary, dead or alive.
* Time spent courting---cannot be negative, will likely be numeric, may be distrete (e.g. 10 mins or 20 minutes) or continuous, ratio type.
* Female reproduction egg production---count type data, not negative, discrete (integers), ratio type.
* Change in fish length---could be negative or positive, ratio type.
* Body condition index (a measure of the weight of an individual relative to its length)-only positive, likely continuous, ratio type.

**Q2. How many fish and how many of each sex?**

* 300 female and 300 female.

**Q3. What treatments were there?**

* Five diets varying in protein and lipid content (Table 2 in paper).
* Three provisioning levels (100%, 75% or 50% of ad libitum intake).
* A total of 15 dietary treatments.


**Q4. What are the important features of the data?**

* **Number of variables**: not too many as a designed experiment with clear question.
* **Number of observations**: number of fish (they were "individually housed", and assigned treatment on an individual level).
* **Variables describing manipulations**: yes, two.
* **Correlation among variables**: low (factorial experiment, though some imbalance likely)
* **Independence of observations**: there may be multiple observations per fish (repeated measures). Fish may share mothers, fathers, and other pre-experiment conditions.


**Q5. Which datafiles do you need?**

```{r}
mortality <- read_csv("data/Moatt_et_al_Data_S1.csv")
courtship <- read_csv("data/Moatt_et_al_Data_S5.csv")
eggs <- read_csv("data/Moatt_et_al_Data_S6.csv")
length_weight_condition <- read_csv("data/Moatt_et_al_Data_S15.csv")
```


**Q6. Which variables tell us about the experimental design (including the explantory variables) and when observations were made?**

* **FID** – Unique ID for each individual.
* **Diet** – Diet Treatment (Diet P:L: 1 = 10.2:1, 2 = 4.6:1, 3 = 2.5:1, 4 = 8.5:1, 5 = 1.6:1).
* **Sex** – Sex of individual (M = male, F = female).
* **Size** – Size classification of individual (L = large, S = Small).
* **Level** – Provisioning level, values represent percentages of monthly ad libitum monitoring.
* **Week_F** – Experimental week.
* **Batch** – Weighing batch.


**Q7. Which variables in which dataset can be used to calculate each of the five response variables?**

* Mortality: `status`, 0 = alive, 1 = Dead, in `Moatt_et_al_Data_S1.csv`
* Time spent courting: `Total_court` – Total time courting across all trials, in `Moatt_et_al_Data_S5.csv`.
* Female reproduction egg production: `Total_egg` – Total number of eggs produced, in `Moatt_et_al_Data_S6.csv`.
* Change in fish length: Ln – Length of individual in mm, in `Moatt_et_al_Data_S15.csv`. 
* Body condition index: CI – Condition Index for each individual, `Moatt_et_al_Data_S15.csv`. 


**Q8. How many rows are in each dataset?**

* `Moatt_et_al_Data_S1.csv`:  33'049 rows, 24 variables
* `Moatt_et_al_Data_S5.csv`: 228, 16
* `Moatt_et_al_Data_S6.csv`: 269, 14
* `Moatt_et_al_Data_S15.csv`:6000, 18


**Q9. Which of the datasets are tidy and which are not?**

All four datasets appear tidy, at the moment.

**Q10. Rename the following variables to be more intepretable, and only keep necessary variables:**

```{r}
courtship <- courtship %>%
  select(Fish_ID=FID, Family, Shelf_stack, Diet_comp=Diet,
         Prov_level=Level, Fish_size=Size, Trial, Total_court)
eggs <- eggs %>%
  select(Fish_ID=FID, Family, Shelf_stack=Stack_shelf, Diet_comp=Diet,
         Prov_level=Level, Fish_size=Size, Total_egg)
length_weight_condition <- length_weight_condition %>%
  select(Fish_ID=FID, Shelf_stack, Diet_comp=Diet, Sex=Sex,
         Batch,
         Prov_level=Level, Fish_size=Size, Length=Ln, Weigth=Wt, Cond_index=CI)
mortality <- mortality %>%
  select(Fish_ID=FID, Diet_comp=Diet, Sex,
         Prov_level=Level, Fish_size=Size, Week=Week_F, Status)
```


**Q11. Replace codes with informative words, for at least the `Diet` variable (or what you renamed it to), the `Fish_size` variable, the `Sex` variable, and the `Status` variable.**

```{r}
courtship <- courtship %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"))

eggs <- eggs %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"))

length_weight_condition <- length_weight_condition %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"),
         Sex = case_when(Sex == "M" ~ "Male",
                         Sex == "F" ~ "Female"))

mortality <- mortality %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"),
         Sex = case_when(Sex == "M" ~ "Male",
                         Sex == "F" ~ "Female"),
         Status = case_when(Status == 0 ~ "alive",
                            Status == 1 ~ "dead"))

```


**Q12. which of the four datasets contains an odd duplicate entry? And which fish is involved? What should we do next?**

```{r}
courtship %>% select(Fish_ID) %>%
  duplicated() %>%
  sum()

eggs %>% select(Fish_ID) %>%
  duplicated() %>%
  sum()

length_weight_condition %>% select(Fish_ID, Batch) %>%
  duplicated() %>%
  sum()

mortality %>% select(Fish_ID, Week) %>%
  duplicated() %>%
  sum()



dupl <- mortality %>% select(Fish_ID, Week) %>%
  duplicated()

filter(mortality, dupl)
filter(mortality, Fish_ID=="LR504", Week==2)
filter(mortality, Fish_ID=="LR504")
```

In the mortality dataset fish LR504 has two records for week 2.

```{r}
# here we check if this is the only fish with fewer records than weeks it was observed in
check <- mortality %>%
  group_by(Fish_ID) %>%
  summarise(check = length(unique(Week))==max(Week))
check %>%
  filter(!check)
```



### NAs, variable entries, e.g. levels of characters, ranges of numerics, numbers of "things"*

**Q13. How many missing values in the courtship dataset (remember to reduce the variables to those mentioned above)?**

```{r}
courtship %>%
  filter_all(any_vars(is.na(.))) 
```


**Q14. Which variable(s) contain missing values?**

*See answer for previous question.*

**Q15. Which fish have missing values?**

*See answer for previous question.*

**Q16. How many different entries are there in the `Shelf_stack` variable?**

```{r}
courtship %>%
  pull(Shelf_stack) %>%
  unique()
```


**Q17. What are the mean and median of the `Total_court` variable?**

```{r}
courtship %>%
  summarise(mean_total_court = mean(Total_court, na.rm=T),
            media_total_court = median(Total_court, na.rm=T))
```


**Q18 What are the units of the `Total_court` variable? (This is a trick/sneaky question.)**


**Q19. How many fish are in each of the datasets?**

```{r}
courtship %>%
  pull(Fish_ID) %>%
  unique() %>%
  length()
```
```{r}
eggs %>%
  pull(Fish_ID) %>%
  unique() %>%
  length()
```


```{r}
skim(eggs)
filter(eggs, is.na(Total_egg))
```
269 fish IDs

```{r}
length_weight_condition %>%
  pull(Fish_ID) %>%
  unique() %>%
  length()
```

600 fish IDs

```{r}
mortality %>%
  pull(Fish_ID) %>%
  unique() %>%
  length()
```


## Independence

**Q20. Which of the datasets contains only one observation per fish, and which contain repeated (i.e. multiple) observations of each fish?**


```{r}
sum(table(pull(courtship, Fish_ID)) > 1)
```

Zero shows that no fish have more than one observation.

```{r}
sum(table(pull(eggs, Fish_ID)) != 1)
```

Zero shows that no fish have more than one observation.

```{r}
sum(table(pull(length_weight_condition, Fish_ID)) != 1)
```

All 600 fish have more than one observation... there is non-independence that we'll have to deal with.

```{r}
sum(table(pull(mortality, Fish_ID)) != 1)
```
586 of the 594 fish in the mortality dataset have more than one observation... there is non-independence that we'll have to deal with.


## Balance in experimental design

**Q21: From the description of the experiment in the paper, how many fish are there per treatment combination?**

```{r}
courtship %>%
  group_by(Diet_comp, Prov_level) %>%
  summarise(count=n(),
            n_unique=length(unique(Fish_ID)))
```

```{r}
eggs %>%
  group_by(Diet_comp, Prov_level) %>%
  summarise(n(),
            n_unique=length(unique(Fish_ID)))
```




```{r}
length_weight_condition %>%
  group_by(Diet_comp, Prov_level) %>%
  summarise(n(),
            n_unique=length(unique(Fish_ID)))
```

```{r}
mortality %>%
  group_by(Diet_comp, Prov_level) %>%
  summarise(n(),
            n_unique=length(unique(Fish_ID)))
```

## Calculate response variable(s) (if required) {#do-regression}

The courtship and eggs datasets already contain the response variable.

**Q22. Calculate the response variable for the change in fish length and change in body condition from the `length_weight_condition` dataset, and the time of death (or no death [censored]) from the `mortality` dataset.**

```{r}
# Time of death
temp_mortality2 <- mortality %>%
  filter(Status=="alive") %>%
  group_by(Fish_ID, Diet_comp, Prov_level, Sex) %>%
  summarise(Lifespan=max(Week))
last_obs <- mortality  %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  summarise(Last_sample=max(Week))
mortality2 <- full_join(temp_mortality2, last_obs) %>%
  mutate(Censored=ifelse(Lifespan==Last_sample, T, F),
         Lifespan=ifelse(is.na(Lifespan), 0, Lifespan),
         Censored=ifelse(Lifespan==0, FALSE, Censored)) %>%
  ungroup() %>%
  select(-Last_sample)
```

Above, we set the eight fish that were already dead at week 1 as having a lifespan of zero.


```{r}
# Change in length
change1 <- length_weight_condition %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  do(m1 = tidy(lm(Length ~ Batch, data=.))) %>%
  unnest() %>%
  filter(term=="Batch") %>%
  select(Fish_ID, Diet_comp, Prov_level, Length_change=estimate)
```

Note that `tidy` silently drops NA coefficients.

```{r}
# Change in condition
change2 <- length_weight_condition %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  do(m1 = tidy(lm(Cond_index ~ Batch, data=.))) %>%
  unnest() %>%
  filter(term=="Batch") %>%
  select(Fish_ID, Diet_comp, Prov_level, CI_change=estimate)
```

Note that `tidy` silently drops NA coefficients.

**Q23. Merge all the datasets.**

```{r}
dd <- full_join(courtship, eggs) %>%
  full_join(mortality2) %>%
  full_join(change1) %>%
  full_join(change2)
```

**Q24. Bring in and merge the diet composition dataset (`diet_comp_treatments.csv`).**

```{r}
diet_comp <- read_csv("data/diet_comp_treatments.csv")
dd <- full_join(dd, diet_comp)
```

**Q25. Reorder the `Diet_comp` variable, and make the `Prov_level` a factor with appropriate order.**

```{r}
dd <- mutate(dd,
             Diet_comp = fct_relevel(Diet_comp,
                                            "1.6:1",
                                            "2.5:1",
                                            "4.6:1",
                                            "8.5:1",
                                            "10.2:1"),
             Prov_level = fct_relevel(as.character(Prov_level),
                                            "50",
                                            "75",
                                            "100"))

```

**Q26. There are some irregularities in this merged dataset. Can you spot them?**

```{r}
dd %>%
  filter(Sex == "Female", !is.na(Total_court))
```

```{r}
dd %>%
  filter(Sex == "Male", !is.na(Total_egg))
```

**Q27. Now use the versions of the datafiles that have the word "udpated" in their name.**

```{r message = FALSE, warning = FALSE}
rm(list=ls())
mortality <- read_csv("data/Moatt_et_al_Data_S1_updated.csv")
courtship <- read_csv("data/Moatt_et_al_Data_S5_updated.csv")
eggs <- read_csv("data/Moatt_et_al_Data_S6_updated.csv")
length_weight_condition <- read_csv("data/Moatt_et_al_Data_S15_updated.csv")
courtship <- courtship %>%
  select(Fish_ID=FID, Family, Shelf_stack, Diet_comp=Diet,
         Prov_level=Level, Fish_size=Size, Trial, Total_court)
eggs <- eggs %>%
  select(Fish_ID=FID, Family, Shelf_stack=Stack_shelf, Diet_comp=Diet,
         Prov_level=Level, Fish_size=Size, Total_egg)
length_weight_condition <- length_weight_condition %>%
  select(Fish_ID=FID, Shelf_stack, Diet_comp=Diet, Sex=Sex,
         Batch,
         Prov_level=Level, Fish_size=Size, Length=Ln, Weigth=Wt, Cond_index=CI)
mortality <- mortality %>%
  select(Fish_ID=FID, Diet_comp=Diet, Sex,
         Prov_level=Level, Fish_size=Size, Week=Week_F, Status)
courtship <- courtship %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"))

eggs <- eggs %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"))

length_weight_condition <- length_weight_condition %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"),
         Sex = case_when(Sex == "M" ~ "Male",
                         Sex == "F" ~ "Female"))

mortality <- mortality %>%
  mutate(Diet_comp = case_when(Diet_comp == 1 ~ "10.2:1",
                               Diet_comp == 2 ~ "4.6:1",
                               Diet_comp == 3 ~ "2.5:1",
                               Diet_comp == 4 ~ "8.5:1",
                               Diet_comp == 5 ~ "1.6:1"),
         Fish_size = case_when(Fish_size == "S" ~ "Small",
                               Fish_size == "L" ~ "Large"),
         Sex = case_when(Sex == "M" ~ "Male",
                         Sex == "F" ~ "Female"),
         Status = case_when(Status == 0 ~ "alive",
                            Status == 1 ~ "dead"))

# Check for the odd duplicate
check <- mortality %>%
  group_by(Fish_ID) %>%
  summarise(check = length(unique(Week))==max(Week))
check %>%
  filter(!check)
# no rows... excellent

# Time of death
temp_mortality2 <- mortality %>%
  filter(Status=="alive") %>%
  group_by(Fish_ID, Diet_comp, Prov_level, Sex) %>%
  summarise(Lifespan=max(Week))
last_obs <- mortality  %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  summarise(Last_sample=max(Week))
mortality2 <- full_join(temp_mortality2, last_obs) %>%
  mutate(Censored=ifelse(Lifespan==Last_sample, T, F),
         Lifespan=ifelse(is.na(Lifespan), 0, Lifespan),
         Censored=ifelse(Lifespan==0, FALSE, Censored)) %>%
  ungroup() %>%
  select(-Last_sample)


# Change in length
change1 <- length_weight_condition %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  do(m1 = tidy(lm(Length ~ Batch, data=.))) %>%
  unnest() %>%
  filter(term=="Batch") %>%
  select(Fish_ID, Diet_comp, Prov_level, Length_change=estimate)


# Change in condition
change2 <- length_weight_condition %>%
  group_by(Fish_ID, Diet_comp, Prov_level) %>%
  do(m1 = tidy(lm(Cond_index ~ Batch, data=.))) %>%
  unnest() %>%
  filter(term=="Batch") %>%
  select(Fish_ID, Diet_comp, Prov_level, CI_change=estimate)

dd <- full_join(courtship, eggs) %>%
  full_join(mortality2) %>%
  full_join(change1) %>%
  full_join(change2)

diet_comp <- read_csv("data/diet_comp_treatments.csv")
dd <- full_join(dd, diet_comp)

dd <- mutate(dd,
             Diet_comp = fct_relevel(Diet_comp,
                                     "1.6:1",
                                     "2.5:1",
                                     "4.6:1",
                                     "8.5:1",
                                     "10.2:1"),
             Prov_level = fct_relevel(as.character(Prov_level),
                                      "50",
                                      "75",
                                      "100"))

# Check for fish doing what they shouldn't be..
dd %>%
  filter(Sex == "Female", !is.na(Total_court))
dd %>%
  filter(Sex == "Male", !is.na(Total_egg))


```

Excellent... there are no odd duplicates, no male fish laying eggs, and no female fish engaging in courtship.


Q28. Write a few sentences about the distribution of each of the five response variables.

```{r}
dd %>%
  ggplot() +
  geom_histogram(aes(x=Total_court))
dd %>%
  ggplot() +
  geom_histogram(aes(x=Total_egg))
dd %>%
  ggplot() +
  geom_histogram(aes(x=Lifespan))
dd %>%
  ggplot() +
  geom_histogram(aes(x=Length_change))
dd %>%
  ggplot() +
  geom_histogram(aes(x=CI_change))
```


## Inspect relationships

**Q29. Confirm in a graph the stated result: "Male mortality risk was lowest on intermediate lipid intakes".**

```{r}
dd <- dd %>%
  mutate(period=cut(Lifespan, breaks=c(-1, 20, 60, 106, 120)))
dd %>%
  filter(Sex=="Male") %>%
  ggplot() +
  geom_point(aes(x=Lipid, y=Lifespan, col=Prov_level),
             position = position_jitterdodge(jitter.width=0.05)) +
  facet_wrap(~period, nrow=3)
```



```{r}
dd %>%
  filter(Sex=="Male") %>%
  ggplot() +
  geom_point(aes(x=Lipid, y=Lifespan, col=Prov_level),
             position = position_jitterdodge(jitter.width=0.05)) +
  facet_wrap(~period, nrow=3)
```

Q30. Confirm in a graph the stated result: "Female risk was generally reduced by low protein intakes."

```{r}
dd %>% 
  filter(Sex=="Female") %>%
  ggplot() +
  geom_point(aes(x=Protein, y=Lifespan, col=Prov_level),
             position = position_jitterdodge(jitter.width=0.05)) +
  facet_wrap(~period, nrow=3)
```

Q31. Confirm in a graph the stated result: "The effect of macronutrient intake on reproduction was similar between the sexes, with high protein intakes maximizing reproduction."

```{r}
dd %>%
  filter(Sex=="Male") %>%
  ggplot() +
  geom_point(aes(x=Protein, y=Total_court, col=Prov_level),
             position = position_jitterdodge(jitter.width=0.05))
```



```{r}
dd %>%
  filter(Sex=="Female") %>%
  ggplot() +
  geom_point(aes(x=Protein, y=Total_egg, col=Prov_level), position = position_jitterdodge(jitter.width=0.2, dodge.width = 5))

```



## Below are lists of variables in each of the four used datasets.

## Moatt et al Data S1 – Mortality Data

* FID – Unique ID for each individual.
* Diet – Diet Treatment (Diet P:L: 1 = 10.2:1, 2 = 4.6:1, 3 = 2.5:1, 4 = 8.5:1, 5 = 1.6:1).
* Sex – Sex of individual (M = male, F = female).
* Size – Size classification of individual (L = large, S = Small).
* Level – Provisioning level, values represent percentages of monthly ad libitum monitoring.
* Total_eaten – Total pellet eaten in g from the start of the experiment.
* Eaten_wk – Amount of pellet consumed that week (gweek-1).
* P_tot - Total protein eaten in g from the start of the experiment.
* P2_total – P_tot2 squared (i.e. the total protein eaten squared). 
* P_wk – Amount of protein consumed that week (gweek-1).
* P2_wk – P_wk2 squared (i.e. the weekly protein intake squared).
* L_tot - Total lipid eaten in g from the start of the experiment.
* L2_total – L_tot2 squared (i.e. the total lipid eaten squared). 
* L_wk – Amount of lipid consumed that week (gweek-1).
* L2_wk – L_wk2 squared (i.e. the weekly lipid intake squared).
* Weight – Weight of fish from last weighing (g).
* Week_F – Experimental week.
* Status – Survival status (0= alive, 1 = Dead).
* T_group – Time period of the experiment (see Fig. S1).
* Initial_weight – Initial weight of individual at the start of the experiment.
* ZP – P_wk z transformed (mean of 0 and standard deviation of 1).
* ZP2 – P2_wk z transformed (mean of 0 and standard deviation of 1).
* ZL – L_wk z transformed (mean of 0 and standard deviation of 1).
* ZL2 – L2_wk z transformed (mean of 0 and standard deviation of 1).

## Moatt et al Data S5 – Courtship Data

* FID – Unique ID for each individual.
* Family – Unique code for family group (i.e. clutch of origin). Each clutch produced from a unique sire and dam.
* Shelf_stack – Unique code for the stack and shelf of fish home tank.
* Diet – Diet Treatment (Diet P:L: 1 = 10.2:1, 2 = 4.6:1, 3 = 2.5:1, 4 = 8.5:1, 5 = 1.6:1).
* Level – Provisioning level, values represent percentages of monthly ad libitum monitoring.
* Size – Size classification of individual (L = large, S = Small).
* Trial – Number of trials that individual experienced.
* Days_breeding – Length of breeding season for that individual.
* P_day – Average protein intake per day during the breeding season (gday-1).
* P2_day – P_day2 squared (i.e. daily protein intake squared).
* L_day - Average lipid intake per day during the breeding season (gday-1).
* L2_day – L_day2 squared (i.e. daily lipid intake squared).
* Mean_react – Mean reaction time across all trials for that individual.
* Total_ZZ – Total number of zigzags across all trials.
* Total_leads – Total number of leads across all trials.
* Total_court – Total time courting across all trials.

## Moatt et al Data S6 – Eggs Data

* FID – Unique ID for each individual.
* Family – Unique code for family group (i.e. clutch of origin). Each clutch produced from a unique sire and dam.
* Shelf_stack – Unique code for the stack and shelf of fish home tank.
* Diet – Diet Treatment (Diet P:L: 1 = 10.2:1, 2 = 4.6:1, 3 = 2.5:1, 4 = 8.5:1, 5 = 1.6:1).
* Level – Provisioning level, values represent percentages of monthly ad libitum monitoring.
* Size – Size classification of individual (L = large, S = Small).
* P_day – Average protein intake per day during the breeding season (gday-1).
* P2_day – P_day2 squared (i.e. daily protein intake squared).
* L_day - Average lipid intake per day during the breeding season (gday-1).
* L2_day – L_day2 squared (i.e. daily lipid intake squared).
* Days_breeding – Length of breeding season for that individual.
* Number_clutches – Number of clutches produced by that individual.
* Mean_number – Mean number of eggs per clutch.
* Total_egg – Total number of eggs produced.

## Moatt et al Data S15 – Length, Weight and Condition Index Data

* FID – Unique ID for each individual.
* StackShelf – Unique code for the stack and shelf of fish home tank.
* Sex – Sex of individual (M = male, F = female).
* Diet – Diet Treatment (Diet P:L: 1 = 10.2:1, 2 = 4.6:1, 3 = 2.5:1, 4 = 8.5:1, 5 = 1.6:1).
* Level – Provisioning level, values represent percentages of monthly ad libitum monitoring.
* Size – Size classification of individual (L = large, S = Small).
* Batch – Weighing batch. NB Batch 1 is prior to diet treatments therefore has no corresponding values for protein and lipid intake.
* P_day – Average protein intake per day during the breeding season (gday-1).
* P2_day – P_day2 squared (i.e. daily protein intake squared).
* L_day - Average lipid intake per day during the breeding season (gday-1).
* L2_day – L_day2 squared (i.e. daily lipid intake squared).
* ZP – Daily protein intake z transformed (mean of 0 and standard deviation of 1), calculated for each sex independently.
* ZP2 – Daily protein intake squared, z transformed (mean of 0 and standard deviation of 1), calculated for each sex independently.
* ZL – Daily lipid intake z transformed (mean of 0 and standard deviation of 1), calculated for each sex independently.
* ZL2 – Daily lipid intake squared, z transformed (mean of 0 and standard deviation of 1), calculated for each sex independently.
* Ln – Length of individual in mm.
* Wt – Weight of individual in g.
* CI – Condition Index for each individual. 

